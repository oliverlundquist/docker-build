FROM oliverlundquist/php7:latest
MAINTAINER Oliver Lundquist "mail@oliverlundquist.com"

RUN apt-get update && apt-get install -y xvfb chromium libgconf-2-4

RUN { \
        echo '#!/bin/sh'; \
        echo 'Xvfb :99 -ac -screen 0 1280x720x16 -nolisten tcp +extension RANDR &'; \
        echo 'sleep 1'; \
        echo 'export DISPLAY=:99'; \
        echo 'exec $@'; \
    } > /root/run-script.sh \
    && chmod +x /root/run-script.sh

RUN mkdir -p /var/app/current
WORKDIR /var/app/current

ENTRYPOINT ["/root/run-script.sh"]
CMD ["php", "artisan", "dusk"]
