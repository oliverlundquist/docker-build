FROM nginx:1.10.3
MAINTAINER Oliver Lundquist "mail@oliverlundquist.com"

COPY docker/build/assets/http.conf /etc/nginx/nginx.conf
COPY docker/build/assets/server.conf /etc/nginx/conf.d/default.conf

RUN { \
        echo '#!/bin/sh'; \
        echo 'FASTCGI_PASS_URI=${FASTCGI_PASS_URI:-php:9000}'; \
        echo 'sed -i.bak s/FASTCGI_PASS_URI/$FASTCGI_PASS_URI/g /etc/nginx/conf.d/default.conf'; \
        echo 'exec $@'; \
    } > /root/run-script.sh \
    && chmod +x /root/run-script.sh

ENTRYPOINT ["/root/run-script.sh"]
